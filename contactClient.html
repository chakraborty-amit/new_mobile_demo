<!DOCTYPE html> 
<html>
	<head>
	<meta charset="utf-8">
	<meta name = "viewport" content = "user-scalable=1,width=device-width" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	
	<title>Contact Client </title>
		
	<!--loading style-->	
	<link rel="stylesheet" href="css/jquery-mobile-1.3.2.min.css" />
	
	<link type="text/css" rel="stylesheet" href="css/jquery-date-box-style.css" />
	  
	
  
<!--loading Scripts-->
<script src="script/jquery-1.8.2.min.js"></script>
<script src="script/jquery-url.js"></script> 
 <script src="script/jquery-date-box-core.js"></script>
 <script type="script/datePicker.js"></script>
	<script src="script/forcetk.js"></script> 

<script src="script/jquery.mobile-1.3.2.min.js"></script> 

    
	
	
   
 
		
				
<style>
.footer {
position: fixed;
z-index: 10;
bottom: 0;
width: 100%;

}

.ui-dialog-contain {
	width: 92.5%;
	max-width: 600px;
	margin: 10% auto 15px auto;
	padding: 0;
	position: relative;
	top: -15px;
}
</style>

    </head>
    <body>
		
<div data-role="page" id="contactedClient"  data-theme="a">


	<script>
	var Company;
	var id;
	var Name;
	var Industry;
	var Phone;
        var company;
		 var industry;
		 var contactname;
		  var phone;
	var client;


	$("#contactedClient").bind("pageshow", function(event){
	
        var loginUrl    = 'https://login.salesforce.com/';
        var clientId    = '3MVG9A2kN3Bn17hvmoy9tG0LfuBA6ruCTPR2a3BXY9uO55IokKrZTZf1_kcqiWhCYy6aw_ooo4DY_qACbpNk9';
        var redirectUri = 'https://ec2-54-200-226-66.us-west-2.compute.amazonaws.com:443/new_mobile_demo/home.html';
        var proxyUrl    = 'https://ec2-54-200-226-66.us-west-2.compute.amazonaws.com:443/new_mobile_demo/proxy.php?mode=native';
         client = new forcetk.Client(clientId, loginUrl,proxyUrl);
	/* var url = $.url(document.location);
     var record = url.param("selectedCompany");
		Company = record.Company;
		Id = record.Id;
		Name = record.Name;
		Industry = record.Industry;
		Phone = record.Phone;*/
		//var index = url.param("selectedIndex");
		
		// with local storage
		//var record=localStorage.detailedRecord;
		
		//alert(record);
		
		  company=localStorage.Company;
		  industry=localStorage.Industry;
		  contactname=localStorage.Name;
		 var street=localStorage.Street;
		 var city=localStorage.City;
		 var state=localStorage.State;
		 var zip=localStorage.PostalCode;
		 var country=localStorage.Country;
		  phone=localStorage.Phone;
		 var email=localStorage.Email;
		  id=localStorage.Id;
		 
		 if(company!=="null"){
		 $('#Company').text(company);}
		 
        if(industry!=="null")		 
		 $('#Industry').text(industry);
		 
		if(contactname!=="null")
		 $('#ContactName').text(contactname);
		 if(street!=="null")
		 $('#Street').text(street);
		 if(city!=="null")
	     $('#City').text(city);
		 if(state!=="null")
		 $('#State').text(state);
		 if(zip!=="null")
	     $('#Zip').text(zip);
		 if(country!=="null")
		 $('#Country').text(country);
		 if(phone!=="null")
	     $('#Phone').text(phone);
		 if(email!=="null")
		 $('#Email').text(email);
		 if(id!=="null")
		 $('#Id').text(id);
			
    
	  

  
	
	});
	</script>
	

		
      <div data-theme="b" data-role="header" data-position="fixed">
         <h5>
            XYZ Insurance
          </h5>
     </div>
    <div data-role="content">
		
		  	
						
		<div id="navBar" data-role="navbar" data-iconpos="right" class="navBar">
            <ul>
                <li>
                    <a href="home.html" data-transition="slide" data-theme="b" data-icon="" class="ui-btn-active ui-state-persist" data-ajax="false">
                        Open
                    </a>
                </li>
                <li>
                    <a href="accepted.html" data-transition="slide" data-theme="a" data-icon="" data-ajax="false">
                        Contacted
                    </a>
                </li>
                <li>
                    <a href="proposed.html" data-transition="slide" data-theme="a" data-icon="" data-ajax="false">
                        Proposed
                    </a>
                </li>
            </ul>
        </div>
		
		
		<br>
		 
		 
	
		
<div class="content-primary">
		
 <div class="ui-grid-a"  >
	<div class="ui-block-a ">
	 <div class="ui-bar ui-bar-b" style="height:50px;">Company:</div>
    </div>
				
	<div class="ui-block-b">
	  <div class="ui-bar ui-bar-d" style="height:50px;"  id="Company"></div>
    </div>
	
	<div class="ui-block-a">
	  <div class="ui-bar ui-bar-b" style="height:50px;">Industry:</div>
    </div>
	
	<div class="ui-block-b">
	  <div class="ui-bar ui-bar-d" style="height:50px;" id="Industry"> </div>
    </div>
	
	<div class="ui-block-a">
	  <div class="ui-bar ui-bar-b" style="height:50px;">Name of Contact  :</div>
    </div>
	
	<div class="ui-block-b">
	  <div class="ui-bar ui-bar-d" style="height:50px;" id="ContactName"></div>
    </div>
	
		<div class="ui-block-a">
	  <div class="ui-bar ui-bar-b"  style="height:110px;">Address :</div>
    </div>
	
	<div class="ui-block-b">
	  <div class="ui-bar ui-bar-d"  style="height:110px;">
	                         <label id="Street"></label><br>
                            <label id="City"></label>
                            <label id="State"></label>
							<label id="Country"></label>
                            <label id="Zip"></label>

	  
	   <div class="ui-grid-b"  >
	<div class="ui-block-a "> </div>
	<div class="ui-block-b "> </div>
   
	<div class="ui-block-c"><a href="#popupMap" data-role="button" data-rel="popup"  data-theme="d" data-inline="true" data-mini="true" data-transition="slidedown" data-position-to="window" >View On Map</a> </div>
	</div>
	  
	
			
	  </div>
    </div>
	
		
	<div class="ui-block-a">
	  <div class="ui-bar ui-bar-b"style="height:60px;">Mobile Number :</div>
    </div>
	
	<div class="ui-block-b">
	  <div class="ui-bar ui-bar-d"style="height:60px;"><a href="'tel:'+Phone"   data-role="button" data-theme="c" id="Phone"></a></div>
    </div>
	
	<div class="ui-block-a">
	  <div class="ui-bar ui-bar-b" style="height:60px;">Email Id :</div>
    </div>
	
	<div class="ui-block-b" >
	  <div class="ui-bar ui-bar-d" style="height:60px;"><a id="Email" href="mailto:"+email data-role="button" data-theme="d"
  rel="external"></a></div>
    </div>
	<div class="ui-block-a">
	  <div class="ui-bar ui-bar-b"  style="height:60px;">Skype Id :</div>
    </div>
	
	<div class="ui-block-b">
	  <div class="ui-bar ui-bar-d"  style="height:60px;"><a id="Skype"  href="skype:steve-beckner?call" data-role="button" data-theme="d">steve-beckner</a></div>
    </div>
	
	


	
</div><!-- /grid-b -->
 
			
</div><!--context Primary-->
	
	<div class="content-secondary">
	
	<div class="ui-grid-b">
	

	 <div class="ui-block-a" style="height:60px"></div>
	 <div class="ui-block-a"></div>
	 <div class="ui-block-b" ><a href="#"  id="contactedButton" data-role="button"  data-theme="b"  data-overlay-theme="b" class="ui-corner-all" data-ajax="false">Contacted</a></div>
	 <div class="ui-block-c"> 	</div>
	 
	 <div class="ui-block-a" style="height:80px"></div><!--some issue with footer adding to avoid it remove later-->
	 
    </div><!-- /grid-b -->
	
</div><!--context secondary-->

</div><!-- /content -->
	
<div data-role="footer" data-position="fixed" data-theme="b">
		
		<p>Developed by &copy; 2013 Accenture Technology Labs</p>
	</div>	
	
	<div data-role="popup" id="popupMap" data-overlay-theme="a" data-theme="a"  data-tolerance="15,15">
 
    <a href="#" data-rel="back" data-role="button" data-theme="b" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
 
 	<div class="ui-bar-c ui-corner-all ui-shadow" style="padding:1em;">
    <iframe src="map.html" width="480" height="320" seamless></iframe>
	</div>
 
    </div><!--popup-->



</div><!-- /Page -->	
				
	<div id="myDialog" data-role="dialog">
<div data-role="content"  data-theme="b">
    
                                
                                                <div data-role="fieldcontain">
                                <label for="mydate">Meeting Date</label>

       <input name="mydate" id="meetingDate" type="date" data-role="datebox"
       data-options='{"mode": "datebox"}'>
        </div>
                                
          <div data-role="fieldcontain">
            <label for="textarea2">
                Meeting Notes
            </label>
            <textarea name="" id="meetingnote" placeholder=""></textarea>
        </div>
      <div class="ui-grid-a">
                                
                                                
                <div class="ui-block-a">
                
                  <a id="acceptButton" data-theme="b" data-icon="forward" data-iconpos="left" data-role="button" data-ajax="true"> Accept</a>
    </div>
                
                <div class="ui-block-b">
                  <a href="home.html" data-theme="b"  data-icon="delete" data-iconpos="left"data-role="button" data-ajax="false"> Reject</a>
    </div>
                
  </div>
</div>
</div>
	
		

	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
    <script type="text/javascript" src="script/jquery.ui.map.js"></script>	
    <script type="text/javascript" src="script/jquery.ui.map.extensions.js"></script>
	
	<script type="text/javascript">
		

$(document).on('pageinit', '#contactedClient', function(){       
  
   //alert('Parameter ID: ' + sessionStorage.ParameterID);


 $(document).on('click', '#contactedButton',function(e) {
                       $.mobile.changePage('#myDialog', {transition: 'slidedown', role: 'dialog'}); 
    });

	$(document).on('click', '#acceptButton',function(e) {
     
 	 
  updatesfdclocaldb();
  

   
    });
	
	
 });
    


$(document).on('pagebeforeshow', '#contactedClient', function(){       
    
	//alert("contactedClient");
	
	
    
	
 });
 
/* $(function() {
    $("#updateData").on("click", function() {
		updatesfdclocaldb();
    });
});*/

var shortName = 'SFDCMOBILEDEMODB';
	        var version = '1.0';
	        var displayName = 'SFDCMOBILEDEMODB TEST';
	        var maxSize = 5 * 1024 * 1024;	
		
					 var access_token;
    var instance_url;
	var DEMODB;
function initdatabase() {
	try {
	    if (!window.openDatabase) {
	        alert('Local Databases are not supported by your browser.');
	    } else {
	        DEMODB = openDatabase(shortName, version, displayName, maxSize);
			//alert("Else");
			
	    }
	} catch(e) {

	    if (e == 2) {
	        console.log("Invalid database version.");
	    } else {
	        console.log("Unknown error "+ e +".");
	    }
	    return;
	} 
}

function createTable(){
 
	DEMODB.transaction(
        function (tx) {
		//alert("create");
		   
        	tx.executeSql('CREATE TABLE IF NOT EXISTS CONTACT(cid TEXT NOT NULL PRIMARY KEY, cname TEXT, ccompany TEXT, cindustry TEXT, cphone TEXT,meetingDate TEXT,meetingNote TEXT);', [], nullDataHandler, errorHandler);
			//alert("Table created");
        }
		
    );
}

function insertContact(id, name, company, industry, phone, meetingDate,meetingNote){
		//alert(id+" "+name+" "+company+" "+industry+" "+phone);
	DEMODB.transaction(
	    function (tx) {

		var data = [id,name,company,industry,phone,meetingDate,meetingNote];  
		tx.executeSql("INSERT INTO CONTACT(cid, cname, ccompany, cindustry, cphone, meetingDate, meetingNote) VALUES (?, ?, ?, ?, ?, ?, ?)", [data[0], data[1], data[2], data[3], data[4], data[5],data[6]]);
	    }
		
	);	
 
	}
	

function updateLeadStatus() {
DEMODB.transaction(function (tx) {
  tx.executeSql('SELECT * FROM SFDCCredentials', [], function (tx, results) {
   var len = results.rows.length, i;
   
   for (i = 0; i < len; i++){
	 access_token = results.rows.item(i).Authtoken;
	 instance_url = results.rows.item(i).Instanceurl;
	 
							client.setSessionToken(access_token, null,
								instance_url);
							client.upsert('Lead','Status',id,{"Status":"Working - Contacted"},
								function(response)
										  {                          		  
										   //alert("Updated");
										   document.location.href = 'accepted.html';
										   }					
								);
   }
 }, null);
});	
}

function updatesfdclocaldb(){


	initdatabase();
	createTable();
	var meetingDate=$('#meetingDate').val();
	var meetingNote=$('#meetingnote').val();
	    
	
	insertContact(id, contactname, company, industry, phone,meetingDate,meetingNote);
	
	
	updateLeadStatus();
}
function errorHandler(transaction, error){
 	if (error.code==1){
 	} else {
	    console.log('Oops.  Error was '+error.message+' (Code '+error.code+')');
 	}
    return false;
}


function nullDataHandler(){
	console.log("SQL Query Succeeded");
}
        </script>
	
	

    
	</body>
</html>